################################################################################
#                     DO NOT EDIT THIS FILE (Auto-Generated)                   #
# Contents of this file were generated by https://github.com/parcelLab/.github #
# Changes to this file may be overwritten.                                     #
################################################################################
name: ~Lib / Docs
on:
  workflow_call:
    inputs:
      botEmail:
        required: false
        description: The email of the bot that will appear in the GitOps commit
        default: dev.bot@parcellab.com
        type: string
      botName:
        required: false
        description: The name of the bot that will appear in the GitOps commit
        default: parcellab-dev-bot
        type: string
      defaultBranch:
        required: false
        description: The default branch
        default: main
        type: string
      docsRepo:
        required: false
        description: The repository within Github that holds the central documentation files
        default: parcelLab/documentation
        type: string
env:
  DOCS_PUSH_FOLDER: ${{ github.workspace }}/remote/repos/${{ github.event.repository.name }}
jobs:
  jekyll:
    if: github.ref == 'refs/heads/${{ inputs.defaultBranch }}'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current git repository
        uses: actions/checkout@v3
        with:
          path: this
      - name: Checkout ${{ inputs.docsRepo }} git repository
        uses: actions/checkout@v3
        with:
          path: remote
          ref: main
          repository: ${{ inputs.docsRepo }}
          token: ${{ secrets.REPO_ACCESS_TOKEN }}
      - name: Commit markdown files
        continue-on-error: true
        run: |
          rm -rf ${{ env.DOCS_PUSH_FOLDER }}
          mkdir -p ${{ env.DOCS_PUSH_FOLDER }}
          cd ${{ env.DOCS_PUSH_FOLDER }}
          git config --global user.email "${{ inputs.botEmail }}"
          git config --global user.name "${{ inputs.botName }}"
          rsync -am --prune-empty-dirs --include='*.md' --include='.assets/*' --include='*/' --exclude='*' ${{ github.workspace }}/this/ ${{ env.DOCS_PUSH_FOLDER }}
          git add -v .
          git commit -m "Update ${{ github.event.repository.name }} repo documentation"
      - name: Push changes to ${{ inputs.docsRepo }} git repository
        if: success()
        uses: ad-m/github-push-action@v0.6.0
        with:
          directory: ${{ env.DOCS_PUSH_FOLDER }}
          repository: ${{ inputs.docsRepo }}
          github_token: ${{ secrets.REPO_ACCESS_TOKEN }}
          branch: ${{ inputs.defaultBranch }}
          force: true
